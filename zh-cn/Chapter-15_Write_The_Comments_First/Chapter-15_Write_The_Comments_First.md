翻译完成时间：2024.03.10

第一次校对时间：-

第二次校对时间：-

---

许多开发者将文档的编写，推迟到开发接近尾声之时，也就是在编码和单测完成之后，这无疑会导致文档质量的下降。编写注释的最佳时机，是在整个过程的开始阶段，即在你编写代码时。首先编写注释使文档成为设计流程的一部分，这不仅可以产生更好的文档，而且还可以产生更好的设计，这让编写文档的过程变得更加有趣。

### 15.1 延迟的注释是不好的注释

几乎我们见过的每个开发者，都会推迟注释的编写。当我们询问他们为什么不尽早编写文档时，他们回答说代码仍在变化中，如果他们过早编写文档，那当代码发生变化时，他们就需要再重新编写文档，所以最好等到代码稳定后，再进行文档的编写。可是我猜测这里还有另外一个原因，即他们将编写文档视为一项苦差事，因此，他们尽可能久的推迟文档的编写。

不幸的是，这样的做法可能会带来一些不好的结果。首先，延迟文档的编写，通常意味着永远不会进行编写。一旦你开始拖延，就很容易再拖延更多的一些时间，毕竟，再过几周代码会更加稳定。当代码变得无可争辩的稳定时，往往已经积累和很多代码，这意味着编写文档，变成了一个非常巨大且毫无吸引力的任务。从来都不会有一个适当的时间，专门暂停几天用于补充所有缺失的注释，此时很容易合理化的认为，当前对于项目最佳的事情，就是继续前进并修复漏洞，或开始开发下一个特性。而这将会产生更多无注释的代码。

哪怕如果你有很强的自律性，使得你能够回去编写注释（不要欺骗你自己，你大概率不会这样做），此时的注释也不会非常好。到了这个阶段，你已经在心里完成了核对。在你的脑海中，这段代码已经完成了，你更想要向前推进，进入到下一个项目中。你知道编写注释是正确的事情，但是它很无趣，你只想尽可能快的完成它。因此，你快速浏览代码，添加恰好适量的注释，让其看起来还不错。到目前为止，距离你设计代码已经过了一段时间，所以你记忆中的设计过程已经变得模糊。编写注释时对照着代码，因此注释只是重复了代码的逻辑。即使你尝试重构代码中并不明显的设计思想，也会有一些你已经忘记的事情。因此，注释遗漏了那些本应描述的重要事情。

### 15.2 优先编写注释

我采用几种不同的方式来编写注解，并且是在非常初始的地方进行。

* 对于一个新的类，我从编写类接口的注释开始。
* 接下来，我为那些相对重要的公有方法，编写接口的注释和签名，但我会让方法体留白。
* 我对这些注释进行了一些迭代，直到感觉基础结构足够正确为止。
* 此时，我为类实例中最重要的一些变量编写声明和注释。
* 最后，我填充这些方法体，并按需增加对于实现的注释，
* 当编写方法体时，我通常发现额外所需的方法和实例变量。对于每个新增的方法，我都会在实现方法体之前编写接口注释。对于实例变量，我会在编写变量声明的同时，填充相关注释。

当代码编写完成时，注释也同时完成，从来不会积压未编写的注释。

注释优先的方法有三个好处。首先，它产生了更好的注释。如果你在设计类的同时编写注释，关键的设计问题在你的脑海中将会非常清晰，所以你很容易去记录它们。其次，对于每个方法，在编写方法体之前，首先编写方法接口注释会更好一些，因为这样你就可以聚焦于方法的抽象和接口，而不会被实现所干扰。而在编码和测试的过程中，你将注意并修复注释中的问题。最终，注释将会改善开发的整个流程。

### 15.3 注释是一种设计工具

其次，也是最重要的一点，早期编写注释的一大好处，是能够改善系统的设计。注释提供了充分捕获抽象的唯一方法，良好的抽象是优秀系统设计的基础。假设在起始阶段就通过编写注释来描述抽象，就可以在编写实现之前，回顾并调整它们。要编写良好的注释，你必须识别一个变量或一段代码的精髓，这个东西最重要的方面是什么？在设计早期就这样做是非常重要的，否则你就是在混乱编码。

注释就像复杂度煤矿中的金丝雀，一旦某个方法或变量需要很长的注释，那就是一个危险的信号，表明你没有进行良好的抽象。在第四章中有提到过，类应该是深层的，对于一个良好的类来说，哪怕它实现了非常强大的功能，也应该只有一个非常简单的接口。判断接口复杂度的最好方式，就是查看用于描述该接口的注释。如果方法的接口注释，提供了使用该方法所需的所有信息，而且十分简短，这就表明这个方法有一个简单的接口。相反，如果只有根据冗长且复杂的注释，才能完整地描述该方法，那这个方法的接口就是复杂的。你可以通过对比方法的接口注释和实现，来感知方法的深度，如果接口注释必须描述实现的所有主要特征，那这个方法就是肤浅的。这种判断方式对变量同样生效，如果需要冗长的注释才能完整地描述一个变量，这是一个危险的信号，表明你可能没有正确地分解变量。总的来说，编写注释的行为，让你能够在早期评估你的设计决策，因此你能狗尽早地发现和修复这些问题。

危险信号：难以描述

用于描述方法和变量的注释应该是简单且完整的，如果你发现难以编写这样的注释，这或许是一种迹象，表明正在描述的事物存在一些设计上的问题。

毋庸置疑，完整且清晰的注释是很好的复杂度指标。如果你编写的方法接口注释，没有提供调用该方法所需的所有信息，或者其中的某些信息非常模糊，以至于难以理解，那它就无法提供一个有效的衡量指标，来衡量方法的深度。

### 15.4 尽早编写注释会更有趣

尽早编写注释的最后一个好处是，尽早编写会让注释的编写更加有趣。对我来说，编程中最有趣的阶段之一，就是在新类的设计早期，那时我逐步完善抽象，并建立类的结构。我的大多数注释都是在这个阶段完成的，这些注释记录了我如何验证自己设计决策的质量，那时我在寻找一种设计，期望能够通过最少的单词，来完整且清晰地进行表达。注释越简单，我对自己的设计越满意，所以寻找简单注释是我的骄傲之源。如果你正在战略编程，那你的主要目标是优秀的设计，而非仅仅是编写代码完成工作，那编写注释应该是非常有趣的，因为它是识别最佳设计的方法。

### 15.5 尽早编写注释，真的成本很高吗？

现在让我们重回延迟编写注释的争论，在该争论中，延迟编写注释防止了代码演进时，重新编写注释的花费。一个简单且粗略的计算表明，这并不会节省很多时间。首先，估计编写代码和编写注释所花费的时间，在全部开发时间中的占比，包括调整代码和注释的时间。它们不太可能超过全部开发时间的 10%。即使半数代码都是注释，那编写注释所花费的时间，也不会超过总开发时间的 5%。将编写注释推迟到最后，只会节省这一小部分时间，而且它们并不是很多。

首先编写注释，意味着在开始编码之前，抽象就已经足够稳定。这大概率会节省编码的时间。相反，如果首先编写代码，抽象可能会随着代码一同进化，相较于首先编写注释的方式，这将需要更多的代码变更。当考虑了所有这些因素后，总体来说首先编写注释可能会更快速。

### 15.6 结论

如果从来没有尝试过首先编写注释，尝试一下吧。坚持足够长的时间来形成习惯。然后思考下它如何影响你的注释质量、设计质量和你对软件开发的兴趣。当尝试了一段时间之后，让我知道你与我的感受是否相同，及其原因是什么。