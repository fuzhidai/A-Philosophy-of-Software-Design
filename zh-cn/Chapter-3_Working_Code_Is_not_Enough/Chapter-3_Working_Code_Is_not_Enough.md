翻译完成时间：2024.04.06

第一次校对时间：-

第二次校对时间：-

---

处理编程任务时采用的思维方式，是良好软件设计的重要元素。许多组织鼓励战术思维，关注于让特性尽可能快的运行起来。然而，如果想要得到一个好的设计，必须采用更加战略的方式，投入时间来产生整洁设计，修复问题。本章讨论为什么战略方法能够产生更好的设计，以及为什么长期来看，战略方法要比战术方法更节省成本。

### 3.1 战术编程

多数编程者进行软件开发时所采用的思维，我称为战术编程思维。在战术方法中，主要关注于让某些东西运行起来，比如一个新的特性，或一个漏洞修复。第一眼看到这个，似乎是合情合理的，还有什么比编写能运行的代码更重要呢？然而，战术编程却几乎不可能产生好的软件设计。

战术编程的问题，在于它是短视的。如果采用战术编程，就会尝试尽快完成任务。或许你有一个强制的截止时间。最终，为未来作计划的优先级将会很低。你不会花费很多时间来寻找最好的设计，只想让某些东西快点运行起来。你告诉自己，如果能让当前任务更快完成，那增加一点复杂度，或引入一两个临时方案也是可以接受的。

这就是系统变得更加复杂的原因。正如前面章节所探讨的，复杂度是递增的。并不是某个特定的事物让系统变得复杂，而是数十上百的小事物累积而成。如果采用战术编程，每个编程任务都会增加一点复杂度。为了尽快完成当前任务，每个任务看起来都有合情合理的理由。然而，复杂度将会快速累积，如果每个人都战术编程则更是如此。

不久之后，某些复杂度将会开始引发问题，你开始希望如果早期没有采用这些取巧方式该多好。但你仍会告诉自己，让下一个新特性运行起来，比重构现存代码更重要。重构长期来看或许有所帮助，但它肯定会减缓当前任务。所以，你寻找快速布丁，来解决遇到的任何问题。这只会更加更多的复杂度，会需要更多的补丁。不久代码就会非常混乱，到目前为止，事情已经非常糟糕，这将需要花费几个月的时间，来对其进行整理。你的日程安排不可能容忍这种延迟，修复一两个问题，似乎并不会有什么不同，所以你会继续进行战术编程。

如果已经在某个大型软件项目上工作了很久，我想你可能已经在工作中见识过了战术编程，也体会过了它带来的问题。一旦开始选择了战术方式，将很难改变。

几乎每个软件开发组织，都至少有一个这样的开发者，他将战术编程发挥到了极致：战术龙卷风。战术龙卷风是指这样的一些开发者，他们快速生产代码，且远远快于其它人，而代码几乎都是战术风格。当他们实现一个敏捷特性时，没有任何人能比战术龙卷风更快完成。在某些组织，管理者认为战术龙卷风就是英雄。然而，战术龙卷风会留下一连串的破坏。他们很少被某些工程师认为是英雄，因为这些工程师后续将必须在他的代码上工作。通常，其它工程师比如清理战术龙卷风留下的混乱，从而让这些工程师（真正的英雄）的进度更慢于战术龙卷风。

### 3.2 战略设计

成为一名优秀软件设计师的第一步，就是认识到：**仅让代码能工作是不够的**。为了更快完成当前工作，而引入非必要的复杂度是不可接受的。软件的长期结构才是最重要的事。任何系统中的大部分代码，都是由现有代码而扩展，所以作为开发者，最重要的工作就是使这些未来的扩展更便捷。因此，尽管代码必须能运行，但不应将 “能工作的代码” 作为主要目标。主要目标必须是创造出伟大的设计，并且它也刚好有效。这就是战略编程。

战略编程需要投资思维。必须投入时间来优化系统设计，而不是采取捷径快速完成当前项目。这些投入可能会在短期内稍微减缓进度，但长期来看，它们将会加快进度，正如图 3.1 所示。

有些投入是主动的。举个例子，花费额外的一点时间，来寻找每个新类的简单设计，这是很有价值的，与其实现脑海中出现的第一个想法，不如多尝试一些备选设计，然后选择最简洁的那个。设想一些未来系统可能发生变动的方式，确保你的设计能够轻松适配。编写好的注释是另一个主动投入的例子。

另一些投入是被动的。无论之前投入了多少，设计决策不可避免的会有错误。随着时间的流逝，这些错误可能会逐渐明显。当发现这些设计问题时，不要忽略它，或只给它打个补丁，多花一些额外的时间来修复它。如果采用战略编程，将可以不断为系统增加小的优化。这也战术编程刚好相反，那里不断增加的是复杂度，而这些复杂度会在未来带来问题。

### 3.3 投入多少？

那么，投入多少是合适的呢？大量的前期投入（比如尝试设计整个系统）并不高效。这是瀑布开发的方式，我们知道这没什么作用。最佳的设计会随着对系统的了解，逐渐浮现。因此，最好是在持续投入的基础上，进行大量的小规模投入。我建议投入 10%-20% 的开发时间。这样的时间占比足够小，不会对日程安排产生明显影响，但又足够大，能够随时间的发展，而产生明显的收益。相比于纯战术编程的方式，基于战略方式开发的项目，初始阶段会因此而多出 10%-20% 的耗时。这部分额外的时间，将会带来更好的软件设计，并使你在几个月内感受到收益。用不了多久，你的开发速度就会比战术编程快 10%-20%。到了这个阶段，你将无需再进行额外投入，过去投入节省的时间，将能够覆盖未来投入的成本。你将很快收回最初的投入成本。图 3.1 说明了这种现象。

图 3.1：开始时，战术编程的进度会比战略编程略快。然而，战术编程下的复杂度累积越来越快，降低了生产力。随着时间的发展，战略编程取得了更好的进展。注意：该图的目的是仅作定性分析，我没有对曲线的精确数据有任何测量。

相反，如果采用战术编程，首个项目的完成时间会快 10%-20%，但随着时间的发展，开发速度将由于复杂度的累积而下降。用不了多久，编程进度就至少会慢 10%-20%。你很快就会归还开始时节省的时间，在系统剩余的生命周期里，你的开发速度都会慢于采用战略编程的情况。如果你还没有在这样糟糕的代码库中工作过，可以问下那些工作过的人，他们将会告诉你，糟糕的代码质量，至少会减慢 20% 的开发速度。

### 3.4 初创公司与投入

在某些场景下，存在一些与战略方法相对抗的强力。比如，早期创业公司存在巨大压力，来尽快完成最初版本的发布。在这些公司，可能就连 10%-20% 的投入也无法负担。最终，许多初创公司采用了战术方法，花费少量时间来进行设计，当突然出现问题时，用于进行清理工作的时间就更少了。他们对这种方式的解释是，如果他们成功了，那将会有足够的金钱来聘用额外的工程师，进行这些清理工作。

如果你所在的公司正向这个方向发展，你应该意识到，一旦代码库变成意大利面，那几乎无法修复。在产品的整个生命周期内，你很可能需要付出高昂的开发成本。除此以外，良好（糟糕）设计的效果往往很快就会显现，因此战术方法很有可能并不会加速首个产品的发布。

另一件需要考虑的事情，公司成功的重要因素之一，正是高质量的工程师。降低开发成本的最佳策略，就是聘用优秀的工程师，相比于普通的工程师，他们不会增加很多的成本，但却具有非常高效的生产力。然而，优秀的工程师都很关注设计的好坏。如果代码库残破不堪，消息传播出去，会让招聘更加困难。最终，你只可能招聘到普通的工程师。这会增加你的成本，并可能引发系统结构的进一步降级。

初创公司脸书就是使用战术方法的一个例子。在很多年里，公司的格言是 “快速行动，打破常规”。鼓励刚从大学毕业的新工程师，立刻投入公司代码库操作，这让工程师在工作的第一周，就提交代码到生产环境，变得十分常见。从积极的一面来看，脸书通过为员工赋权而闻名。工程师有很大的自由，几乎没有什么规则和限制来阻碍他们。

作为一家公司，脸书取得了让人印象深刻的成功，但它的代码库却因公司的战术方式，而深受其害，许多代码都很不稳定，难以理解，基本不存在注释和测试，并与它们一起工作非常痛苦。随着时间的推移，公司认识到它的文化是无法持续的。最终，脸书将其格言改为了 “用坚实的基础设施来快速行动”，以此鼓励工程师投入更多的时间，进行良好的设计。脸书是否能成功清理多年战术编程积累的问题，还有待观察。

公平地说，我应该指出，脸书的代码可能并不比创业公司的平均水平差多少。战术编程在创业公司中很常见，只是脸书恰好是一个特别明显的例子。

幸运的是，在硅谷通过战略方法来取得成功也是可能的。Google 和 WMware 与 Facebook 同期生长，但这两家公司都拥抱了战略方法。两家公司都非常注重高质量的代码，以及优秀的设计，并且都基于可靠的软件系统，构建了复杂的产品来解决复杂的问题。公司强大的技术文化，也在硅谷广为人知。在招聘高端技术人才上，很少有其它公司能与其竞争。

这些例子表明，无论采用哪一种方法，公司都可以取得成功。但在一家关心软件设计，并拥有整洁代码库的公司，工作要有趣的多。

### 3.5 结论

好的设计并不会凭空出现。它需要持续不断的投入，这样小问题就不会累积为大问题。幸运的是，好的设计最终会带来回报，而且远比想象的快。

至关重要的是，要始终如一的运用战略方法，并把投入看作今天的事，而不是明天。在紧急情况下，很容易会把清理工作推迟到情况结束后。然而，这会是一个滑坡效应，在当前的危机之后，几乎可以肯定还会有另一个，然后再是另一个。一旦开始拖延设计的改进，临时的拖延就很容易变成永久的取消，就会让文化滑向战术方法。等待解决设计问题的时间越长，问题就会变得越大，解决方案就会变得更让人生畏，这使它们更可能被推迟。最有效的方法是，让每个工程师都在良好的设计上，持续进行小规模的投入。