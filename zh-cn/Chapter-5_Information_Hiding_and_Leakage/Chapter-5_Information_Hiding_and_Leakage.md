在第四章中，我们说明了模块应当是深层的。本章和后续一些章节，将讨论创建深层模块的一些技术。

### 5.1 信息隐藏

信息隐藏最早由 David Parnas 提出，是实现深层模块最重要的技术。其基本思想是每个模块都应对一些知识进行封装，这些知识体现了设计上的决策。这些知识嵌入在模块的实现中，但并不出现在其接口中，因此对模块不可见。

隐藏在模块内的信息通常由一些细节组成，这些细节是关于如何实现某些功能的详细信息。下面是一些信息的示例，它们可能需要隐藏被模块内。

* 如何在 B-tree 中存储信息，以及如何高效访问它们。
* 如何识别文件内每个逻辑块对应的物理磁盘块。
* 如何实现 TCP 网络协议。
* 如何在多核处理器上调度线程。
* 如何解析 JSON 文档。

隐藏信息包括与实现机制相关的数据结构和算法。它也可以包括底层细节，例如页大小，或者包括更加抽象的顶层概念，例如对大多数文件均为小文件的假设。

信息隐藏在两个方向上降低了复杂度。首先，它简化了模块接口。使接口提供的模块功能视图，更加简单且抽象，从而隐藏了细节，降低了模块开发者的认知负载。举例来说，B-tree 类的开发者，无需关心树中节点的理想构型，也无需关心树平衡度的保持方式。其次，信息隐藏让系统演进更易进行。如果某段信息已隐藏，那除包含该信息的模块外，没有其它模块对该其存在依赖，因此关联该信息的设计改动，只会影响单个模块。例如，如果 TCP 协议变更（比如，引入新的拥塞机制），则协议实现将会需要修改，但使用 TCP 进行收发消息的高层代码却无需修改。

设计新模块时，应仔细思考哪些信息可以被隐藏在模块内。隐藏的信息越多，模块接口就越简单，模块就越深层。

注意，通过将类中的变量和方法定义为 private 来隐藏它们，并非信息隐藏。私有化元素有助于信息隐藏，因为这让元素无法从外部类直接访问。然而，隐藏于私有项的信息，仍然可以通过公有方法（如 getter 和 setter 方法）进行暴露。这种情况发生时，变量的性质和用法就像公有变量一样被公开。

全部隐藏信息于模块中，是信息以藏的最好形式，如此一来，它对于模块用户来说，将是无关且不可见的。然而，部分信息隐藏同样也有价值。比如，如果某个特性或某些信息仅为类的小部分用户所需，那可以通过单独的方法来访问，这样大部分的用户场景都不会看到它，此时就最大限度地隐藏了信息。相比于对类全部用户可见的信息，此类信息增加的依赖将会更少一些。