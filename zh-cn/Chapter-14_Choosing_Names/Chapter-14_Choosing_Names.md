## Choosing Names

为变量、方法和其它实体的选择名称，是软件设计中最被低估的方面之一。好的名称是另一种形式的文档，它们让代码变得更易阅读，减少对其它文档的需要，并让发现错误变得更加容易。相反的，糟糕的名称选择，会增加代码的复杂度，使代码变得具有歧义，容易产生错误的理解，最终导致漏洞的产生。名称选择是复杂度递增原则的一个例子，为一个特殊的变量挑选一个平庸的名称，而非最合适的名字，可能不会对系统的整体复杂度产生影响。但是，软件系统包含上千个变量，为所有这些变量选择一个合适的名称，会对系统的复杂度和可维护性带来很大的影响。

### 14.1 示例：引发漏洞的错误名称

有时，即使只是一个变量命名不当，都有可能会产生严重的后果。我曾经修复过的一个最具有挑战性的漏洞，正是源于一个糟糕的命名选择。在八十年代末期，九十年代初期，我和我的毕业生共同开发了一个叫做 Sprite 的分布式操作系统。我们发现有时文件会突然丢失数据，某个数据块会突然被清零，哪怕这个文件从来没有被用户修改过。因为这个问题并非经常发生，因此很难对它进行排查。一些毕业生尝试去找到漏洞，但他们并没有取得任何进展，最终不得不放弃。然而，我认为任何未解决的漏洞，都是无法容忍的个人侮辱，所以我决定继续排查它。

虽然花费了六个月的时间，但最终我还是找到并修复了这个漏洞。问题其实非常的简单（对于大多数漏洞来说，一旦你解决了它们）。文件系统的代码在两个不同的用途下，使用了 block 这个变量。在一些场景中，block 指代磁盘上的物理块数量，而在另一些场景中，block 指代文件内部的逻辑块数量。不幸的是，在一处代码中，block 变量原本用来存储逻辑块的数量，但它意外的被用在了另一个需要物理块数量的上下文中，最终一个磁盘上一个无关的块被覆写为了零。

在排查问题的过程中，不同的人包括我自己，都阅读过这部分有问题的代码，但我们都从来没有注意到这个问题。当我们看到一个名称为 block 的变量，被用于表示物理块的数量时，我们反射式的假设，它真的持有物理块的数量。经过漫长的测试过程，最终表明问题一定出在特定的语句中，然后我才能克服名称带来的心理障碍，并检查其值的确切来源。如果不同的变量名称，被用在不同的类型块上，比如 fileBlock 和 diskBlock，这个错误就不太可能会发生，因为编程者能够知道 fileBlock 不会被用在其它的场景中。

不幸的是，大多数的开发者不会花费很多的时间，来考虑他们命名。他们倾向于使用脑海中出现的第一个名称，只要它与其所命名的事物足够接近。例如，block 足够接近磁盘上的物理块，以及文件中的物理块，它确实不是一个非常糟糕的名称。即使如此，它最终还是导致花费大量的时间，去排查一个不易察觉的漏洞。因此，你不应该满足于采用 “相当接近” 的命名。多花费一些额外的时间，去选择一个更好的名称，它准确、清晰且易懂。额外的投入很快就会得到回报，最终你将学会如何去快速的选择一个好的名称。