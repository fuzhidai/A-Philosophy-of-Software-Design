代码注释在软件设计中扮演着至关重要的角色，为开发者理解系统，高效工作提供了必不可少的帮助，但注释的作用远不止于此。注释也在抽象中扮演了重要角色，缺少注释，你就无法隐藏复杂性。最后，如果正确进行注释的编写，实际上会改善系统的设计。

不幸的是，该观点并未被广泛传播，很多生产环境的代码几乎没有注释。许多开发者认为，编写注释是浪费时间，其它一些开发者虽看到了注释的价值，但不知为何，却从未抽出时间来编写它们。幸运的是，许多开发团队已经认识到了注释的价值，并且看起来这样的团队正变得越来越多。可是，哪怕是在鼓励注释的团队中，注释也经常被认为是繁琐的工作，许多开发者并不理解为什么要编写它们，所以最终的注释往往非常一般。不充分的注释会对软件开发带来不必要的巨大阻力。

本章将会讨论开发者用于逃避编写注释的借口，以及为什么注释真的很重要。第十三章将会讨论如何编写好的注释，后续剩下的一些章节将会探讨相关的一些议题，比如变量名称的选择，以及如何通过文档来改善系统设计。我希望这些章节能使你信服三件事：好的注释会对软件的整体质量产生巨大影响，编写优秀的注释很困难，以及（这或许很难相信）编写注释其实很有趣。

开发者未编写注释时，通常会以下面这些理由来辩解：

* “好代码是自描述的。”
* “我没有时间来编写注释。”
* “注释会过时并产生误导。”
* “我看过的注释都是无价值的，何必呢？”

在下面的章节中，我将会设法处理以上这些借口。

### 12.1 好代码是自描述的

有些人确信，如果代码编写的足够优秀，那很明显无需注释。这是一个美好的幻想，就像冰淇淋对健康有益：我们真的愿意相信它！不幸的是，它肯定不是真的。诚然，编写注释时可以通过某些方式，来减少对注释的需要，例如选择良好的变量名称（第十四章）。尽管如此，仍然存在大部分的设计信息，无法通过代码进行展示。例如，只有类接口的一小部分（例如它方法的签名），能够在代码中正式定义。接口的非正式方面，例如高层次的描述（每个方法的行为，以及它返回值的含义），则只能在注释中描述。有很多其它的事情无法在代码中进行描述，例如特殊设计决策的原因，或调用特定方法的有效条件。

一些开发者认为，如果其他人想要知道方法做了什么，他们应该阅读方法的代码：这比任何注释都更准确。读者或许可以通过阅读代码，从抽象注释中推导方法，但这是非常耗时且痛苦的。此外，如果你预期用户会阅读代码的实现，那你就会让每个方法都尽可能的短小，这样方法就会非常易读。但如果方法执行了任何重要的任务，你将会把它打碎成许多更小的方法。这将会产生一大堆浅层方法。除此之外，它实际并没有让代码变得更易读：为了理解顶层代码的行为，读者将可能需要理解嵌套的方法。对于大型系统，让读者通过阅读代码来学习它们的行为，这非常不切实际。

此外，注释是抽象的基础。回到第四章，抽象的目的是为了隐藏复杂度：抽象是实体的简单视图，保留重要信息，省略那些可以安全忽略的细节。如果用户为了使用方法，而去阅读它的代码，抽象将不复存在：方法的所有复杂度都被暴露出来。没有注释，方法的唯一抽象就是它的声明，指定了它的名称，以及参数和结果的类型。声明缺少了太多重要信息，以至于无法单独提供有效的抽象。例如，某个提取子字符串的方法，可能具有两个参数，start 和 end，用于指定提取字符串的范围。单从声明来看，它不太可能说明提取的字符串是否包含 end 指向的字符，以及如果 start > end 时会发生什么。注释可以补充调用者所需的额外信息，从而在隐藏实现细节的情况下，提供简单的视图。更重要的是，注释通过人类语言（如英语）进行编写，这让它们虽没有代码那样准确，但却提供了更多可表达性，所以我们可以创建一个简洁易懂的描述。如果你想要使用抽象来隐藏复杂度，注释必不可少。

### 12.2 我没时间编写注释

将编写注释的优先级，安排在其它开发任务的优先级之后，通常非常具有诱惑。在增加新特性和注释已有特性之间进行选择时，似乎顺理成章的就会选择前者。可是软件项目几乎总是处于时间的压力之下，并且似乎总是会有比编写注释优先级更高的事。因此，如果降低了编写注释的优先级，那最终可能就是没有注释。

对该借口的反驳是在第十五章将会谈到的投资思维。如果想要一个能够长期高效工作且足够整洁的软件架构，就必须在前期多投入一些额外的时间，来建造该架构。良好的注释能够对软件的可维护性产生巨大影响，因此前期的投入很快就能获得相应回报。除此之外，编写注释并不需要很多时间。问问自己，在开发周期中，有多少时间投入在编写代码（除设计、编译和测试等之外），假设此时没有编写注释，我猜答案应该不超过 10%。现在，假设你需要花费与编写代码同样长的时间，来编写注释，这应该是一个保险的上限。在该假设中，编写良好注释所花费的时间，不会超过开发时间的 10%，而拥有良好注释带来的收益，将很快会抵消该投入成本。

此外，许多重要注释都与抽象有关，例如类和方法的顶层注释。第十五章将会讨论一个观点：这些注释应该在设计过程中进行编写，而该行为作为重要的设计工具，将能改善整体的设计。这些注释将很快证明自己的价值。

### 12.3 注释会过期并会产生误导

注释确实有时会过期失效，但这在实践中并不一定是一个主要问题。保持注释及时更新，并不需要花费大量的努力。只有当代码发生很大的变化时，注释才需要进行大的改动，而此时代码改动所耗费的时间，会远远高于改动注释的时间。第十六章讨论了如何组织注释，以保证代码修改后，注释能够轻松的及时更新（关键思路是防止重复注释，并保证注释尽可能贴近代码）。代码审核提供了很好的机制，来发现和修复失效的注释。

### 12.4 我看到过的注释都没什么价值

在四个借口中，这可能是最有道理的一个。每个软件开发者都见过缺少有用信息的注释，并且大多数注释都非常一般。幸运的是，这个问题是能够解决的，一旦掌握技巧，编写可信赖的注释并不困难。下一章将会提供一个框架，展示如何编写好的注释，并对其进行长期维护。

### 12.5 良好注释的收益

到目前为止，我们已经讨论过了那些反对编写注释的理由，接下来让我们考虑良好注释的收益有哪些。注释背后的整体思路，就是提取信息，这些信息只出现在设计者的脑中，而没有体现在代码中。这些信息向下包括底层细节，例如一个奇怪的硬件问题，而导致的一段棘手代码，向上包括顶层概念，例如类的基本原理。后续其它开发者来修改代码时，注释能让他们更快更准确的工作。没有注释，后续的开发者将不得不重新推导，猜测开发者的原始信息，这将花费额外的时间，若新开发者误解了原设计者的意图，则会有产生漏洞的风险。哪怕进行变更的是设计者本人，注释也同样很有价值：如果其上次对该段代码进行修改，已经是几个星期之前，那可能已经忘记了很多原始设计的细节。

第二章讨论了复杂度在软件系统中的三种表现形式：

**变更扩散：**一个简单的需求，可能需要修改多处的代码。

**认知负载：**为了进行改动，开发者必须积累大量信息。

**未知未知：**当进行变更时，不清楚哪些代码需要修改，也不知道哪些信息需要考虑。

好的注释有助于解决后两个问题。通过为开发者提供变更所需的信息，让开发者能够轻松忽略无关信息，注释降低了认知负载。缺少适当的注释，开发者可能必须阅读大量的代码，以此来推导设计者的思路。通过明晰系统结构，注释同样能够减少不知道的未知信息，对于任何给定的变更，都能清晰获知相关的信息和代码。

第二章指出了复杂度的最大诱因，依赖和晦涩。好的注释能够理清依赖，填补信息缺失，并消除晦涩。

后续几章将展示如何编写良好的注释，也会讨论如何将注释编写整合到设计流程中，以此改善软件的设计。